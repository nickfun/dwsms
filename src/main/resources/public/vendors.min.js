/*
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */
(function(a,b){if(typeof define==="function"&&define.amd){define(["backbone","underscore"],function(f,e){return(a.Marionette=a.Mn=b(a,f,e))})}else{if(typeof exports!=="undefined"){var d=require("backbone");var c=require("underscore");module.exports=b(a,d,c)}else{a.Marionette=a.Mn=b(a,a.Backbone,a._)}}}(this,function(a,g,b){(function(j,i){var h=j.ChildViewContainer;j.ChildViewContainer=function(n,m){var k=function(o){this._views={};this._indexByModel={};this._indexByCustom={};this._updateLength();m.each(o,this.add,this)};m.extend(k.prototype,{add:function(o,q){var p=o.cid;this._views[p]=o;if(o.model){this._indexByModel[o.model.cid]=p}if(q){this._indexByCustom[q]=p}this._updateLength();return this},findByModel:function(o){return this.findByModelCid(o.cid)},findByModelCid:function(o){var p=this._indexByModel[o];return this.findByCid(p)},findByCustom:function(p){var o=this._indexByCustom[p];return this.findByCid(o)},findByIndex:function(o){return m.values(this._views)[o]},findByCid:function(o){return this._views[o]},remove:function(o){var p=o.cid;if(o.model){delete this._indexByModel[o.model.cid]}m.any(this._indexByCustom,function(r,q){if(r===p){delete this._indexByCustom[q];return true}},this);delete this._views[p];this._updateLength();return this},call:function(o){this.apply(o,m.tail(arguments))},apply:function(p,o){m.each(this._views,function(q){if(m.isFunction(q[p])){q[p].apply(q,o||[])}})},_updateLength:function(){this.length=m.size(this._views)}});var l=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];m.each(l,function(o){k.prototype[o]=function(){var p=m.values(this._views);var q=[p].concat(m.toArray(arguments));return m[o].apply(m,q)}});return k}(j,i);j.ChildViewContainer.VERSION="0.1.4";j.ChildViewContainer.noConflict=function(){j.ChildViewContainer=h;return this};return j.ChildViewContainer})(g,b);(function(k,h){var i=k.Wreqr;var j=k.Wreqr={};k.Wreqr.VERSION="1.3.1";k.Wreqr.noConflict=function(){k.Wreqr=i;return this};j.Handlers=function(n,m){var l=function(o){this.options=o;this._wreqrHandlers={};if(m.isFunction(this.initialize)){this.initialize(o)}};l.extend=n.Model.extend;m.extend(l.prototype,n.Events,{setHandlers:function(o){m.each(o,function(r,p){var q=null;if(m.isObject(r)&&!m.isFunction(r)){q=r.context;r=r.callback}this.setHandler(p,r,q)},this)},setHandler:function(p,r,q){var o={callback:r,context:q};this._wreqrHandlers[p]=o;this.trigger("handler:add",p,r,q)},hasHandler:function(o){return !!this._wreqrHandlers[o]},getHandler:function(p){var o=this._wreqrHandlers[p];if(!o){return}return function(){var q=Array.prototype.slice.apply(arguments);return o.callback.apply(o.context,q)}},removeHandler:function(o){delete this._wreqrHandlers[o]},removeAllHandlers:function(){this._wreqrHandlers={}}});return l}(k,h);j.CommandStorage=function(){var l=function(m){this.options=m;this._commands={};if(h.isFunction(this.initialize)){this.initialize(m)}};h.extend(l.prototype,k.Events,{getCommands:function(n){var m=this._commands[n];if(!m){m={command:n,instances:[]};this._commands[n]=m}return m},addCommand:function(n,m){var o=this.getCommands(n);o.instances.push(m)},clearCommands:function(m){var n=this.getCommands(m);n.instances=[]}});return l}();j.Commands=function(l){return l.Handlers.extend({storageType:l.CommandStorage,constructor:function(n){this.options=n||{};this._initializeStorage(this.options);this.on("handler:add",this._executeCommands,this);var m=Array.prototype.slice.call(arguments);l.Handlers.prototype.constructor.apply(this,m)},execute:function(n,m){n=arguments[0];m=Array.prototype.slice.call(arguments,1);if(this.hasHandler(n)){this.getHandler(n).apply(this,m)}else{this.storage.addCommand(n,m)}},_executeCommands:function(m,o,n){var p=this.storage.getCommands(m);h.each(p.instances,function(q){o.apply(n,q)});this.storage.clearCommands(m)},_initializeStorage:function(m){var o;var n=m.storageType||this.storageType;if(h.isFunction(n)){o=new n()}else{o=n}this.storage=o}})}(j);j.RequestResponse=function(l){return l.Handlers.extend({request:function(){var n=arguments[0];var m=Array.prototype.slice.call(arguments,1);if(this.hasHandler(n)){return this.getHandler(n).apply(this,m)}}})}(j);j.EventAggregator=function(n,l){var m=function(){};m.extend=n.Model.extend;l.extend(m.prototype,n.Events);return m}(k,h);j.Channel=function(m){var l=function(n){this.vent=new k.Wreqr.EventAggregator();this.reqres=new k.Wreqr.RequestResponse();this.commands=new k.Wreqr.Commands();this.channelName=n};h.extend(l.prototype,{reset:function(){this.vent.off();this.vent.stopListening();this.reqres.removeAllHandlers();this.commands.removeAllHandlers();return this},connectEvents:function(o,n){this._connect("vent",o,n);return this},connectCommands:function(o,n){this._connect("commands",o,n);return this},connectRequests:function(o,n){this._connect("reqres",o,n);return this},_connect:function(o,p,n){if(!p){return}n=n||this;var q=o==="vent"?"on":"setHandler";h.each(p,function(s,r){this[o][q](r,h.bind(s,n))},this)}});return l}(j);j.radio=function(n){var o=function(){this._channels={};this.vent={};this.commands={};this.reqres={};this._proxyMethods()};h.extend(o.prototype,{channel:function(p){if(!p){throw new Error("Channel must receive a name")}return this._getChannel(p)},_getChannel:function(p){var q=this._channels[p];if(!q){q=new n.Channel(p);this._channels[p]=q}return q},_proxyMethods:function(){h.each(["vent","commands","reqres"],function(p){h.each(m[p],function(q){this[p][q]=l(this,p,q)},this)},this)}});var m={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]};var l=function(p,q,r){return function(s){var u=p._getChannel(s)[q];var t=Array.prototype.slice.call(arguments,1);return u[r].apply(u,t)}};return new o()}(j);return k.Wreqr})(g,b);var d=a.Marionette;var f=g.Marionette={};f.VERSION="2.3.0";f.noConflict=function(){a.Marionette=d;return this};g.Marionette=f;f.Deferred=g.$.Deferred;f.extend=g.Model.extend;f.isNodeAttached=function(h){return g.$.contains(document.documentElement,h)};f.getOption=function(i,h){if(!i||!h){return}if(i.options&&(i.options[h]!==undefined)){return i.options[h]}else{return i[h]}};f.proxyGetOption=function(h){return f.getOption(this,h)};f.normalizeMethods=function(h){return b.reduce(h,function(i,k,j){if(!b.isFunction(k)){k=this[k]}if(k){i[j]=k}return i},{},this)};f.normalizeUIString=function(h,i){return h.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(j){return i[j.slice(4)]})};f.normalizeUIKeys=function(i,h){return b.reduce(i,function(j,m,k){var l=f.normalizeUIString(k,h);j[l]=m;return j},{})};f.normalizeUIValues=function(i,h){b.each(i,function(k,j){if(b.isString(k)){i[j]=f.normalizeUIString(k,h)}});return i};f.actAsCollection=function(i,j){var h=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];b.each(h,function(k){i[k]=function(){var m=b.values(b.result(this,j));var l=[m].concat(b.toArray(arguments));return b[k].apply(b,l)}})};var c=f.deprecate=function(h,i){if(b.isObject(h)){h=(h.prev+" is going to be removed in the future. Please use "+h.next+" instead."+(h.url?" See: "+h.url:""))}if((i===undefined||!i)&&!c._cache[h]){c._warn("Deprecation warning: "+h);c._cache[h]=true}};c._warn=typeof console!=="undefined"&&(console.warn||console.log)||function(){};c._cache={};f._triggerMethod=(function(){var h=/(^|:)(\w)/gi;function i(k,l,j){return j.toUpperCase()}return function(n,o,m){var l=arguments.length<3;if(l){m=o;o=m[0]}var k="on"+o.replace(h,i);var p=n[k];var j;if(b.isFunction(p)){j=p.apply(n,l?b.rest(m):m)}if(b.isFunction(n.trigger)){if(l+m.length>1){n.trigger.apply(n,l?m:[o].concat(b.rest(m,0)))}else{n.trigger(o)}}return j}})();f.triggerMethod=function(h){return f._triggerMethod(this,arguments)};f.triggerMethodOn=function(h){var i=b.isFunction(h.triggerMethod)?h.triggerMethod:f.triggerMethod;return i.apply(h,b.rest(arguments))};f.MonitorDOMRefresh=function(h){function k(){h._isShown=true;i()}function j(){h._isRendered=true;i()}function i(){if(h._isShown&&h._isRendered&&f.isNodeAttached(h.el)){if(b.isFunction(h.triggerMethod)){h.triggerMethod("dom:refresh")}}}h.on({show:k,render:j})};(function(m){function l(r,p,n,o){var q=o.split(/\s+/);b.each(q,function(s){var t=r[s];if(!t){throw new m.Error('Method "'+s+'" was configured as an event handler, but does not exist.')}r.listenTo(p,n,t)})}function h(p,o,n,q){p.listenTo(o,n,q)}function j(r,p,n,o){var q=o.split(/\s+/);b.each(q,function(s){var t=r[s];r.stopListening(p,n,t)})}function i(p,o,n,q){p.stopListening(o,n,q)}function k(q,n,r,p,o){if(!n||!r){return}if(!b.isFunction(r)&&!b.isObject(r)){throw new m.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"})}if(b.isFunction(r)){r=r.call(q)}b.each(r,function(t,s){if(b.isFunction(t)){p(q,n,s,t)}else{o(q,n,s,t)}})}m.bindEntityEvents=function(o,n,p){k(o,n,p,h,l)};m.unbindEntityEvents=function(o,n,p){k(o,n,p,i,j)};m.proxyBindEntityEvents=function(n,o){return m.bindEntityEvents(this,n,o)};m.proxyUnbindEntityEvents=function(n,o){return m.unbindEntityEvents(this,n,o)}})(f);var e=["description","fileName","lineNumber","name","message","number"];f.Error=f.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+f.VERSION+"/",constructor:function(j,i){if(b.isObject(j)){i=j;j=i.message}else{if(!i){i={}}}var h=Error.call(this,j);b.extend(this,b.pick(h,e),b.pick(i,e));this.captureStackTrace();if(i.url){this.url=this.urlRoot+i.url}},captureStackTrace:function(){if(Error.captureStackTrace){Error.captureStackTrace(this,f.Error)}},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}});f.Error.extend=f.extend;f.Callbacks=function(){this._deferred=f.Deferred();this._callbacks=[]};b.extend(f.Callbacks.prototype,{add:function(j,h){var i=b.result(this._deferred,"promise");this._callbacks.push({cb:j,ctx:h});i.then(function(k){if(h){k.context=h}j.call(k.context,k.options)})},run:function(h,i){this._deferred.resolve({options:h,context:i})},reset:function(){var h=this._callbacks;this._deferred=f.Deferred();this._callbacks=[];b.each(h,function(i){this.add(i.cb,i.ctx)},this)}});f.Controller=function(h){this.options=h||{};if(b.isFunction(this.initialize)){this.initialize(this.options)}};f.Controller.extend=f.extend;b.extend(f.Controller.prototype,g.Events,{destroy:function(){f._triggerMethod(this,"before:destroy",arguments);f._triggerMethod(this,"destroy",arguments);this.stopListening();this.off();return this},triggerMethod:f.triggerMethod,getOption:f.proxyGetOption});f.Object=function(h){this.options=b.extend({},b.result(this,"options"),h);this.initialize.apply(this,arguments)};f.Object.extend=f.extend;b.extend(f.Object.prototype,g.Events,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy");this.triggerMethod("destroy");this.stopListening()},triggerMethod:f.triggerMethod,getOption:f.proxyGetOption,bindEntityEvents:f.proxyBindEntityEvents,unbindEntityEvents:f.proxyUnbindEntityEvents});f.Region=f.Object.extend({constructor:function(h){this.options=h||{};this.el=this.getOption("el");this.el=this.el instanceof g.$?this.el[0]:this.el;if(!this.el){throw new f.Error({name:"NoElError",message:'An "el" must be specified for a region.'})}this.$el=this.getEl(this.el);f.Object.call(this,h)},show:function(q,t){if(!this._ensureElement()){return}this._ensureViewIsIntact(q);var r=t||{};var k=q!==this.currentView;var n=!!r.preventDestroy;var p=!!r.forceShow;var l=!!this.currentView;var o=k&&!n;var m=k||p;if(l){this.triggerMethod("before:swapOut",this.currentView,this,t)}if(this.currentView){delete this.currentView._parent}if(o){this.empty()}else{if(l&&m){this.currentView.off("destroy",this.empty,this)}}if(m){q.once("destroy",this.empty,this);q.render();q._parent=this;if(l){this.triggerMethod("before:swap",q,this,t)}this.triggerMethod("before:show",q,this,t);f.triggerMethodOn(q,"before:show",q,this,t);if(l){this.triggerMethod("swapOut",this.currentView,this,t)}var i=f.isNodeAttached(this.el);var s=[];var j=r.triggerBeforeAttach||this.triggerBeforeAttach;var h=r.triggerAttach||this.triggerAttach;if(i&&j){s=this._displayedViews(q);this._triggerAttach(s,"before:")}this.attachHtml(q);this.currentView=q;if(i&&h){s=this._displayedViews(q);this._triggerAttach(s)}if(l){this.triggerMethod("swap",q,this,t)}this.triggerMethod("show",q,this,t);f.triggerMethodOn(q,"show",q,this,t);return this}return this},triggerBeforeAttach:true,triggerAttach:true,_triggerAttach:function(h,j){var i=(j||"")+"attach";b.each(h,function(k){f.triggerMethodOn(k,i,k,this)},this)},_displayedViews:function(h){return b.union([h],b.result(h,"_getNestedViews")||[])},_ensureElement:function(){if(!b.isObject(this.el)){this.$el=this.getEl(this.el);this.el=this.$el[0]}if(!this.$el||this.$el.length===0){if(this.getOption("allowMissingEl")){return false}else{throw new f.Error('An "el" '+this.$el.selector+" must exist in DOM")}}return true},_ensureViewIsIntact:function(h){if(!h){throw new f.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."})}if(h.isDestroyed){throw new f.Error({name:"ViewDestroyedError",message:'View (cid: "'+h.cid+'") has already been destroyed and cannot be used.'})}},getEl:function(h){return g.$(h)},attachHtml:function(h){this.$el.html("");this.el.appendChild(h.el)},empty:function(){var h=this.currentView;if(!h){return}h.off("destroy",this.empty,this);this.triggerMethod("before:empty",h);this._destroyView();this.triggerMethod("empty",h);delete this.currentView;return this},_destroyView:function(){var h=this.currentView;if(h.destroy&&!h.isDestroyed){h.destroy()}else{if(h.remove){h.remove();h.isDestroyed=true}}},attachView:function(h){this.currentView=h;return this},hasView:function(){return !!this.currentView},reset:function(){this.empty();if(this.$el){this.el=this.$el.selector}delete this.$el;return this}},{buildRegion:function(h,i){if(b.isString(h)){return this._buildRegionFromSelector(h,i)}if(h.selector||h.el||h.regionClass){return this._buildRegionFromObject(h,i)}if(b.isFunction(h)){return this._buildRegionFromRegionClass(h)}throw new f.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(h,i){return new i({el:h})},_buildRegionFromObject:function(h,l){var j=h.regionClass||l;var i=b.omit(h,"selector","regionClass");if(h.selector&&!i.el){i.el=h.selector}var k=new j(i);if(h.parentEl){k.getEl=function(n){if(b.isObject(n)){return g.$(n)}var m=h.parentEl;if(b.isFunction(m)){m=m()}return m.find(n)}}return k},_buildRegionFromRegionClass:function(h){return new h()}});f.RegionManager=f.Controller.extend({constructor:function(h){this._regions={};f.Controller.call(this,h);this.addRegions(this.getOption("regions"))},addRegions:function(h,i){if(b.isFunction(h)){h=h.apply(this,arguments)}var j={};b.each(h,function(l,k){if(b.isString(l)){l={selector:l}}if(l.selector){l=b.defaults({},l,i)}var m=this.addRegion(k,l);j[k]=m},this);return j},addRegion:function(h,i){var j;if(i instanceof f.Region){j=i}else{j=f.Region.buildRegion(i,f.Region)}this.triggerMethod("before:add:region",h,j);j._parent=this;this._store(h,j);this.triggerMethod("add:region",h,j);return j},get:function(h){return this._regions[h]},getRegions:function(){return b.clone(this._regions)},removeRegion:function(h){var i=this._regions[h];this._remove(h,i);return i},removeRegions:function(){var h=this.getRegions();b.each(this._regions,function(j,i){this._remove(i,j)},this);return h},emptyRegions:function(){var h=this.getRegions();b.invoke(h,"empty");return h},destroy:function(){this.removeRegions();return f.Controller.prototype.destroy.apply(this,arguments)},_store:function(h,i){this._regions[h]=i;this._setLength()},_remove:function(h,i){this.triggerMethod("before:remove:region",h,i);i.empty();i.stopListening();delete i._parent;delete this._regions[h];this._setLength();this.triggerMethod("remove:region",h,i)},_setLength:function(){this.length=b.size(this._regions)}});f.actAsCollection(f.RegionManager.prototype,"_regions");f.TemplateCache=function(h){this.templateId=h};b.extend(f.TemplateCache,{templateCaches:{},get:function(h){var i=this.templateCaches[h];if(!i){i=new f.TemplateCache(h);this.templateCaches[h]=i}return i.load()},clear:function(){var j;var h=b.toArray(arguments);var k=h.length;if(k>0){for(j=0;j<k;j++){delete this.templateCaches[h[j]]}}else{this.templateCaches={}}}});b.extend(f.TemplateCache.prototype,{load:function(){if(this.compiledTemplate){return this.compiledTemplate}var h=this.loadTemplate(this.templateId);this.compiledTemplate=this.compileTemplate(h);return this.compiledTemplate},loadTemplate:function(h){var i=g.$(h).html();if(!i||i.length===0){throw new f.Error({name:"NoTemplateError",message:'Could not find template: "'+h+'"'})}return i},compileTemplate:function(h){return b.template(h)}});f.Renderer={render:function(i,j){if(!i){throw new f.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."})}var h;if(typeof i==="function"){h=i}else{h=f.TemplateCache.get(i)}return h(j)}};f.View=g.View.extend({constructor:function(h){b.bindAll(this,"render");h=b.isFunction(h)?h.call(this):h;this.options=b.extend({},b.result(this,"options"),h);this._behaviors=f.Behaviors(this);g.View.apply(this,arguments);f.MonitorDOMRefresh(this);this.on("show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},serializeModel:function(h){return h.toJSON.apply(h,b.rest(arguments))},mixinTemplateHelpers:function(h){h=h||{};var i=this.getOption("templateHelpers");if(b.isFunction(i)){i=i.call(this)}return b.extend(h,i)},normalizeUIKeys:function(i){var h=b.result(this,"_uiBindings");return f.normalizeUIKeys(i,h||b.result(this,"ui"))},normalizeUIValues:function(j){var i=b.result(this,"ui");var h=b.result(this,"_uiBindings");return f.normalizeUIValues(j,h||i)},configureTriggers:function(){if(!this.triggers){return}var h=this.normalizeUIKeys(b.result(this,"triggers"));return b.reduce(h,function(j,k,i){j[i]=this._buildViewTrigger(k);return j},{},this)},delegateEvents:function(h){this._delegateDOMEvents(h);this.bindEntityEvents(this.model,this.getOption("modelEvents"));this.bindEntityEvents(this.collection,this.getOption("collectionEvents"));b.each(this._behaviors,function(i){i.bindEntityEvents(this.model,i.getOption("modelEvents"));i.bindEntityEvents(this.collection,i.getOption("collectionEvents"))},this);return this},_delegateDOMEvents:function(k){var i=k||this.events;if(b.isFunction(i)){i=i.call(this)}i=this.normalizeUIKeys(i);if(b.isUndefined(k)){this.events=i}var l={};var m=b.result(this,"behaviorEvents")||{};var j=this.configureTriggers();var h=b.result(this,"behaviorTriggers")||{};b.extend(l,m,i,j,h);g.View.prototype.delegateEvents.call(this,l)},undelegateEvents:function(){g.View.prototype.undelegateEvents.apply(this,arguments);this.unbindEntityEvents(this.model,this.getOption("modelEvents"));this.unbindEntityEvents(this.collection,this.getOption("collectionEvents"));b.each(this._behaviors,function(h){h.unbindEntityEvents(this.model,h.getOption("modelEvents"));h.unbindEntityEvents(this.collection,h.getOption("collectionEvents"))},this);return this},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed){throw new f.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})}},destroy:function(){if(this.isDestroyed){return}var h=b.toArray(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(h));this.isDestroyed=true;this.triggerMethod.apply(this,["destroy"].concat(h));this.unbindUIElements();this.remove();b.invoke(this._behaviors,"destroy",h);return this},bindUIElements:function(){this._bindUIElements();b.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(!this.ui){return}if(!this._uiBindings){this._uiBindings=this.ui}var h=b.result(this,"_uiBindings");this.ui={};b.each(b.keys(h),function(j){var i=h[j];this.ui[j]=this.$(i)},this)},unbindUIElements:function(){this._unbindUIElements();b.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){if(!this.ui||!this._uiBindings){return}b.each(this.ui,function(i,h){delete this.ui[h]},this);this.ui=this._uiBindings;delete this._uiBindings},_buildViewTrigger:function(j){var k=b.isObject(j);var i=b.defaults({},(k?j:{}),{preventDefault:true,stopPropagation:true});var h=k?i.event:j;return function(m){if(m){if(m.preventDefault&&i.preventDefault){m.preventDefault()}if(m.stopPropagation&&i.stopPropagation){m.stopPropagation()}}var l={view:this,model:this.model,collection:this.collection};this.triggerMethod(h,l)}},setElement:function(){var h=g.View.prototype.setElement.apply(this,arguments);b.invoke(this._behaviors,"proxyViewProperties",this);return h},triggerMethod:function(){var k=f._triggerMethod;var j=k(this,arguments);var h=this._behaviors;for(var l=0,m=h&&h.length;l<m;l++){k(h[l],arguments)}return j},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var h=this._getImmediateChildren();if(!h.length){return h}return b.reduce(h,function(j,i){if(!i._getNestedViews){return j}return j.concat(i._getNestedViews())},h)},normalizeMethods:f.normalizeMethods,getOption:f.proxyGetOption,bindEntityEvents:f.proxyBindEntityEvents,unbindEntityEvents:f.proxyUnbindEntityEvents});f.ItemView=f.View.extend({constructor:function(){f.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection){return{}}var h=[this.model||this.collection];if(arguments.length){h.push.apply(h,arguments)}if(this.model){return this.serializeModel.apply(this,h)}else{return{items:this.serializeCollection.apply(this,h)}}},serializeCollection:function(h){return h.toJSON.apply(h,b.rest(arguments))},render:function(){this._ensureViewIsIntact();this.triggerMethod("before:render",this);this._renderTemplate();this.bindUIElements();this.triggerMethod("render",this);return this},_renderTemplate:function(){var i=this.getTemplate();if(i===false){return}if(!i){throw new f.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."})}var j=this.serializeData();j=this.mixinTemplateHelpers(j);var h=f.Renderer.render(i,j,this);this.attachElContent(h);return this},attachElContent:function(h){this.$el.html(h);return this}});f.CollectionView=f.View.extend({childViewEventPrefix:"childview",constructor:function(h){var i=h||{};if(b.isUndefined(this.sort)){this.sort=b.isUndefined(i.sort)?true:i.sort}this.once("render",this._initialEvents);this._initChildViewStorage();f.View.apply(this,arguments);this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment();this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer();this.isBuffering=true},endBuffering:function(){this.isBuffering=false;this._triggerBeforeShowBufferedChildren();this.attachBuffer(this,this.elBuffer);this._triggerShowBufferedChildren();this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){if(this._isShown){b.each(this._bufferedChildren,b.partial(this._triggerMethodOnChild,"before:show"))}},_triggerShowBufferedChildren:function(){if(this._isShown){b.each(this._bufferedChildren,b.partial(this._triggerMethodOnChild,"show"));this._bufferedChildren=[]}},_triggerMethodOnChild:function(h,i){f.triggerMethodOn(i,h)},_initialEvents:function(){if(this.collection){this.listenTo(this.collection,"add",this._onCollectionAdd);this.listenTo(this.collection,"remove",this._onCollectionRemove);this.listenTo(this.collection,"reset",this.render);if(this.sort){this.listenTo(this.collection,"sort",this._sortViews)}}},_onCollectionAdd:function(j){this.destroyEmptyView();var i=this.getChildView(j);var h=this.collection.indexOf(j);this.addChild(j,i,h)},_onCollectionRemove:function(i){var h=this.children.findByModel(i);this.removeChildView(h);this.checkEmpty()},onShowCalled:function(){this.children.each(b.partial(this._triggerMethodOnChild,"show"))},render:function(){this._ensureViewIsIntact();this.triggerMethod("before:render",this);this._renderChildren();this.triggerMethod("render",this);return this},resortView:function(){this.render()},_sortViews:function(){var h=this.collection.find(function(k,j){var i=this.children.findByModel(k);return !i||i._index!==j},this);if(h){this.resortView()}},_emptyViewIndex:-1,_renderChildren:function(){this.destroyEmptyView();this.destroyChildren();if(this.isEmpty(this.collection)){this.showEmptyView()}else{this.triggerMethod("before:render:collection",this);this.startBuffering();this.showCollection();this.endBuffering();this.triggerMethod("render:collection",this)}},showCollection:function(){var h;this.collection.each(function(j,i){h=this.getChildView(j);this.addChild(j,h,i)},this)},showEmptyView:function(){var i=this.getEmptyView();if(i&&!this._showingEmptyView){this.triggerMethod("before:render:empty");this._showingEmptyView=true;var h=new g.Model();this.addEmptyView(h,i);this.triggerMethod("render:empty")}},destroyEmptyView:function(){if(this._showingEmptyView){this.triggerMethod("before:remove:empty");this.destroyChildren();delete this._showingEmptyView;this.triggerMethod("remove:empty")}},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(k,i){var j=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");if(b.isFunction(j)){j=j.call(this,k,this._emptyViewIndex)}var h=this.buildChildView(k,i,j);h._parent=this;this.proxyChildEvents(h);if(this._isShown){f.triggerMethodOn(h,"before:show")}this.children.add(h);this.renderChildView(h,this._emptyViewIndex);if(this._isShown){f.triggerMethodOn(h,"show")}},getChildView:function(i){var h=this.getOption("childView");if(!h){throw new f.Error({name:"NoChildViewError",message:'A "childView" must be specified'})}return h},addChild:function(l,k,j){var i=this.getOption("childViewOptions");if(b.isFunction(i)){i=i.call(this,l,j)}var h=this.buildChildView(l,k,i);this._updateIndices(h,true,j);this._addChildView(h,j);h._parent=this;return h},_updateIndices:function(i,h,j){if(!this.sort){return}if(h){i._index=j;this.children.each(function(k){if(k._index>=i._index){k._index++}})}else{this.children.each(function(k){if(k._index>=i._index){k._index--}})}},_addChildView:function(h,i){this.proxyChildEvents(h);this.triggerMethod("before:add:child",h);this.children.add(h);this.renderChildView(h,i);if(this._isShown&&!this.isBuffering){f.triggerMethodOn(h,"show")}this.triggerMethod("add:child",h)},renderChildView:function(h,i){h.render();this.attachHtml(this,h,i);return h},buildChildView:function(k,j,i){var h=b.extend({model:k},i);return new j(h)},removeChildView:function(h){if(h){this.triggerMethod("before:remove:child",h);if(h.destroy){h.destroy()}else{if(h.remove){h.remove()}}delete h._parent;this.stopListening(h);this.children.remove(h);this.triggerMethod("remove:child",h);this._updateIndices(h,false)}return h},isEmpty:function(){return !this.collection||this.collection.length===0},checkEmpty:function(){if(this.isEmpty(this.collection)){this.showEmptyView()}},attachBuffer:function(i,h){i.$el.append(h)},attachHtml:function(h,j,i){if(h.isBuffering){h.elBuffer.appendChild(j.el);h._bufferedChildren.push(j)}else{if(!h._insertBefore(j,i)){h._insertAfter(j)}}},_insertBefore:function(k,i){var j;var h=this.sort&&(i<this.children.length-1);if(h){j=this.children.find(function(l){return l._index===i+1})}if(j){j.$el.before(k.el);return true}return false},_insertAfter:function(h){this.$el.append(h.el)},_initChildViewStorage:function(){this.children=new g.ChildViewContainer()},destroy:function(){if(this.isDestroyed){return}this.triggerMethod("before:destroy:collection");this.destroyChildren();this.triggerMethod("destroy:collection");return f.View.prototype.destroy.apply(this,arguments)},destroyChildren:function(){var h=this.children.map(b.identity);this.children.each(this.removeChildView,this);this.checkEmpty();return h},proxyChildEvents:function(h){var i=this.getOption("childViewEventPrefix");this.listenTo(h,"all",function(){var j=b.toArray(arguments);var l=j[0];var k=this.normalizeMethods(b.result(this,"childEvents"));j[0]=i+":"+l;j.splice(1,0,h);if(typeof k!=="undefined"&&b.isFunction(k[l])){k[l].apply(this,j.slice(1))}this.triggerMethod.apply(this,j)},this)},_getImmediateChildren:function(){return b.values(this.children._views)}});f.CompositeView=f.CollectionView.extend({constructor:function(){f.CollectionView.apply(this,arguments)},_initialEvents:function(){if(this.collection){this.listenTo(this.collection,"add",this._onCollectionAdd);this.listenTo(this.collection,"remove",this._onCollectionRemove);this.listenTo(this.collection,"reset",this._renderChildren);if(this.sort){this.listenTo(this.collection,"sort",this._sortViews)}}},getChildView:function(i){var h=this.getOption("childView")||this.constructor;return h},serializeData:function(){var h={};if(this.model){h=b.partial(this.serializeModel,this.model).apply(this,arguments)}return h},render:function(){this._ensureViewIsIntact();this.isRendered=true;this.resetChildViewContainer();this.triggerMethod("before:render",this);this._renderTemplate();this._renderChildren();this.triggerMethod("render",this);return this},_renderChildren:function(){if(this.isRendered){f.CollectionView.prototype._renderChildren.call(this)}},_renderTemplate:function(){var j={};j=this.serializeData();j=this.mixinTemplateHelpers(j);this.triggerMethod("before:render:template");var i=this.getTemplate();var h=f.Renderer.render(i,j,this);this.attachElContent(h);this.bindUIElements();this.triggerMethod("render:template")},attachElContent:function(h){this.$el.html(h);return this},attachBuffer:function(i,h){var j=this.getChildViewContainer(i);j.append(h)},_insertAfter:function(i){var h=this.getChildViewContainer(this,i);h.append(i.el)},getChildViewContainer:function(j,l){if("$childViewContainer" in j){return j.$childViewContainer}var i;var k=f.getOption(j,"childViewContainer");if(k){var h=b.isFunction(k)?k.call(j):k;if(h.charAt(0)==="@"&&j.ui){i=j.ui[h.substr(4)]}else{i=j.$(h)}if(i.length<=0){throw new f.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+j.childViewContainer})}}else{i=j.$el}j.$childViewContainer=i;return i},resetChildViewContainer:function(){if(this.$childViewContainer){delete this.$childViewContainer}}});f.LayoutView=f.ItemView.extend({regionClass:f.Region,constructor:function(h){h=h||{};this._firstRender=true;this._initializeRegions(h);f.ItemView.call(this,h)},render:function(){this._ensureViewIsIntact();if(this._firstRender){this._firstRender=false}else{this._reInitializeRegions()}return f.ItemView.prototype.render.apply(this,arguments)},destroy:function(){if(this.isDestroyed){return this}this.regionManager.destroy();return f.ItemView.prototype.destroy.apply(this,arguments)},addRegion:function(h,i){var j={};j[h]=i;return this._buildRegions(j)[h]},addRegions:function(h){this.regions=b.extend({},this.regions,h);return this._buildRegions(h)},removeRegion:function(h){delete this.regions[h];return this.regionManager.removeRegion(h)},getRegion:function(h){return this.regionManager.get(h)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(i){var h={regionClass:this.getOption("regionClass"),parentEl:b.partial(b.result,this,"$el")};return this.regionManager.addRegions(i,h)},_initializeRegions:function(h){var j;this._initRegionManager();if(b.isFunction(this.regions)){j=this.regions(h)}else{j=this.regions||{}}var i=this.getOption.call(h,"regions");if(b.isFunction(i)){i=i.call(this,h)}b.extend(j,i);j=this.normalizeUIValues(j);this.addRegions(j)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new f.RegionManager()},_initRegionManager:function(){this.regionManager=this.getRegionManager();this.regionManager._parent=this;this.listenTo(this.regionManager,"before:add:region",function(h){this.triggerMethod("before:add:region",h)});this.listenTo(this.regionManager,"add:region",function(h,i){this[h]=i;this.triggerMethod("add:region",h,i)});this.listenTo(this.regionManager,"before:remove:region",function(h){this.triggerMethod("before:remove:region",h)});this.listenTo(this.regionManager,"remove:region",function(h,i){delete this[h];this.triggerMethod("remove:region",h,i)})},_getImmediateChildren:function(){return b.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}});f.Behavior=f.Object.extend({constructor:function(i,h){this.view=h;this.defaults=b.result(this,"defaults")||{};this.options=b.extend({},this.defaults,i);f.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){this.stopListening()},proxyViewProperties:function(h){this.$el=h.$el;this.el=h.el}});f.Behaviors=(function(l,j){function h(n,m){if(!j.isObject(n.behaviors)){return{}}m=h.parseBehaviors(n,m||j.result(n,"behaviors"));h.wrap(n,m,j.keys(i));return m}var i={behaviorTriggers:function(n,m){var o=new k(this,m);return o.buildBehaviorTriggers()},behaviorEvents:function(p,m){var n={};var o=j.result(this,"ui");j.each(m,function(q,s){var u={};var v=j.clone(j.result(q,"events"))||{};var r=j.result(q,"ui");var t=j.extend({},o,r);v=l.normalizeUIKeys(v,t);j.each(j.keys(v),function(y){var x=(new Array(s+2)).join(" ");var w=y+x;var z=j.isFunction(v[y])?v[y]:q[v[y]];u[w]=j.bind(z,q)});n=j.extend(n,u)});return n}};j.extend(h,{behaviorsLookup:function(){throw new l.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(m,n){if(m.behaviorClass){return m.behaviorClass}return j.isFunction(h.behaviorsLookup)?h.behaviorsLookup.apply(this,arguments)[n]:h.behaviorsLookup[n]},parseBehaviors:function(n,m){return j.chain(m).map(function(o,p){var r=h.getBehaviorClass(o,p);var s=new r(o,n);var q=h.parseBehaviors(n,j.result(s,"behaviors"));return[s].concat(q)}).flatten().value()},wrap:function(n,m,o){j.each(o,function(p){n[p]=j.partial(i[p],n[p],m)})}});function k(n,m){this._view=n;this._viewUI=j.result(n,"ui");this._behaviors=m;this._triggers={}}j.extend(k.prototype,{buildBehaviorTriggers:function(){j.each(this._behaviors,this._buildTriggerHandlersForBehavior,this);return this._triggers},_buildTriggerHandlersForBehavior:function(n,m){var o=j.extend({},this._viewUI,j.result(n,"ui"));var p=j.clone(j.result(n,"triggers"))||{};p=l.normalizeUIKeys(p,o);j.each(p,j.partial(this._setHandlerForBehavior,n,m),this)},_setHandlerForBehavior:function(q,p,n,o){var m=o.replace(/^\S+/,function(r){return r+".behaviortriggers"+p});this._triggers[m]=this._view._buildViewTrigger(n)}});return h})(f,b);f.AppRouter=g.Router.extend({constructor:function(i){this.options=i||{};g.Router.apply(this,arguments);var j=this.getOption("appRoutes");var h=this._getController();this.processAppRoutes(h,j);this.on("route",this._processOnRoute,this)},appRoute:function(j,i){var h=this._getController();this._addAppRoute(h,j,i)},_processOnRoute:function(i,h){if(b.isFunction(this.onRoute)){var j=b.invert(this.getOption("appRoutes"))[i];this.onRoute(i,j,h)}},processAppRoutes:function(h,j){if(!j){return}var i=b.keys(j).reverse();b.each(i,function(k){this._addAppRoute(h,k,j[k])},this)},_getController:function(){return this.getOption("controller")},_addAppRoute:function(h,j,i){var k=h[i];if(!k){throw new f.Error('Method "'+i+'" was not found on the controller')}this.route(j,i,b.bind(k,h))},getOption:f.proxyGetOption,triggerMethod:f.triggerMethod,bindEntityEvents:f.proxyBindEntityEvents,unbindEntityEvents:f.proxyUnbindEntityEvents});f.Application=f.Object.extend({constructor:function(h){this._initializeRegions(h);this._initCallbacks=new f.Callbacks();this.submodules={};b.extend(this,h);this._initChannel();f.Object.call(this,h)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(h){this._initCallbacks.add(h)},start:function(h){this.triggerMethod("before:start",h);this._initCallbacks.run(h,this);this.triggerMethod("start",h)},addRegions:function(h){return this._regionManager.addRegions(h)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(h){return this._regionManager.removeRegion(h)},getRegion:function(h){return this._regionManager.get(h)},getRegions:function(){return this._regionManager.getRegions()},module:function(h,k){var j=f.Module.getClass(k);var i=b.toArray(arguments);i.unshift(this);return j.create.apply(j,i)},getRegionManager:function(){return new f.RegionManager()},_initializeRegions:function(h){var j=b.isFunction(this.regions)?this.regions(h):this.regions||{};this._initRegionManager();var i=f.getOption(h,"regions");if(b.isFunction(i)){i=i.call(this,h)}b.extend(j,i);this.addRegions(j);return this},_initRegionManager:function(){this._regionManager=this.getRegionManager();this._regionManager._parent=this;this.listenTo(this._regionManager,"before:add:region",function(){f._triggerMethod(this,"before:add:region",arguments)});this.listenTo(this._regionManager,"add:region",function(h,i){this[h]=i;f._triggerMethod(this,"add:region",arguments)});this.listenTo(this._regionManager,"before:remove:region",function(){f._triggerMethod(this,"before:remove:region",arguments)});this.listenTo(this._regionManager,"remove:region",function(h){delete this[h];f._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=b.result(this,"channelName")||"global";this.channel=b.result(this,"channel")||g.Wreqr.radio.channel(this.channelName);this.vent=b.result(this,"vent")||this.channel.vent;this.commands=b.result(this,"commands")||this.channel.commands;this.reqres=b.result(this,"reqres")||this.channel.reqres}});f.Module=function(i,j,h){this.moduleName=i;this.options=b.extend({},this.options,h);this.initialize=h.initialize||this.initialize;this.submodules={};this._setupInitializersAndFinalizers();this.app=j;if(b.isFunction(this.initialize)){this.initialize(i,j,this.options)}};f.Module.extend=f.extend;b.extend(f.Module.prototype,g.Events,{startWithParent:true,initialize:function(){},addInitializer:function(h){this._initializerCallbacks.add(h)},addFinalizer:function(h){this._finalizerCallbacks.add(h)},start:function(h){if(this._isInitialized){return}b.each(this.submodules,function(i){if(i.startWithParent){i.start(h)}});this.triggerMethod("before:start",h);this._initializerCallbacks.run(h,this);this._isInitialized=true;this.triggerMethod("start",h)},stop:function(){if(!this._isInitialized){return}this._isInitialized=false;this.triggerMethod("before:stop");b.invoke(this.submodules,"stop");this._finalizerCallbacks.run(undefined,this);this._initializerCallbacks.reset();this._finalizerCallbacks.reset();this.triggerMethod("stop")},addDefinition:function(h,i){this._runModuleDefinition(h,i)},_runModuleDefinition:function(i,j){if(!i){return}var h=b.flatten([this,this.app,g,f,g.$,b,j]);i.apply(this,h)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new f.Callbacks();this._finalizerCallbacks=new f.Callbacks()},triggerMethod:f.triggerMethod});b.extend(f.Module,{create:function(n,h,i){var j=n;var l=b.rest(arguments,3);h=h.split(".");var k=h.length;var m=[];m[k-1]=i;b.each(h,function(o,p){var q=j;j=this._getModule(q,o,n,i);this._addModuleDefinition(q,j,m[p],l)},this);return j},_getModule:function(n,k,o,m,j){var i=b.extend({},m);var h=this.getClass(m);var l=n[k];if(!l){l=new h(k,o,i);n[k]=l;n.submodules[k]=l}return l},getClass:function(i){var h=f.Module;if(!i){return h}if(i.prototype instanceof h){return i}return i.moduleClass||h},_addModuleDefinition:function(m,i,l,h){var k=this._getDefine(l);var j=this._getStartWithParent(l,i);if(k){i.addDefinition(k,h)}this._addStartWithParent(m,i,j)},_getStartWithParent:function(j,h){var i;if(b.isFunction(j)&&(j.prototype instanceof f.Module)){i=h.constructor.prototype.startWithParent;return b.isUndefined(i)?true:i}if(b.isObject(j)){i=j.startWithParent;return b.isUndefined(i)?true:i}return true},_getDefine:function(h){if(b.isFunction(h)&&!(h.prototype instanceof f.Module)){return h}if(b.isObject(h)){return h.define}return null},_addStartWithParent:function(j,h,i){h.startWithParent=h.startWithParent&&i;if(!h.startWithParent||!!h.startWithParentIsConfigured){return}h.startWithParentIsConfigured=true;j.addInitializer(function(k){if(h.startWithParent){h.start(k)}})}});return f}));